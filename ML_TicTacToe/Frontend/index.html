<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title> ML Tic Tac Toe</title>
        <style>
            body{
                font-family: Arial, Helvetica, sans-serif;
                text-align: center;
                background: #222;
                color: white;
            }
            #board{
                display: grid;
                grid-template-columns: repeat(3,100px);
                grid-gap: 5px;
                justify-content: center;
                margin-top: 50px;
            }
            .cell{
                width: 100px;
                height: 100px;
                font-size: 2rem;
                display: flex;
                justify-content: center;
                align-items: center;
                background: #333;
                cursor: pointer;
                border-radius: 8px;
            }
            .cell:hover{
                background: #444;
            }
        </style>
    </head>
    <body>
        <h1>
            Tic Tac Toe
        </h1>
        <div id="board"></div>
        <script>
            const boardEl = document.getElementById('board');
            let board = Array(9).fill(0); // 0 = empty, 1 = human, -1 = bot
            let gameOver = false;

            function renderBoard() {
                boardEl.innerHTML = '';
                board.forEach((cell, idx) => {
                    const div = document.createElement('div');
                    div.classList.add('cell');
                    div.textContent = cell === 1 ? 'X' : cell === -1 ? 'O' : '';
                    div.addEventListener('click', () => playerMove(idx));
                    boardEl.appendChild(div);
                });
            }

            function checkWinner() {
                const wins = [
                    [0,1,2], [3,4,5], [6,7,8], // rows
                    [0,3,6], [1,4,7], [2,5,8], // cols
                    [0,4,8], [2,4,6] // diagonals
            ];
            for (let [a,b,c] of wins) {
                if (board[a] !== 0 && board[a] === board[b] && board[b] === board[c]) {
                    return board[a]; // 1 = human, -1 = bot
                }
            }
            if (!board.includes(0)) {
                return 0; // draw
            }
            return null; // no winner yet
        }

        function showResult(winner) {
            gameOver = true;
            let message = '';
            if (winner === 1) message = 'üéâ You Won!';
            else if (winner === -1) message = 'ü§ñ Bot Won!';
            else message = 'ü§ù Draw!';

            // Create overlay
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.background = 'rgba(0,0,0,0.8)';
            overlay.style.color = 'white';
            overlay.style.display = 'flex';
            overlay.style.flexDirection = 'column';
            overlay.style.justifyContent = 'center';
            overlay.style.alignItems = 'center';
            overlay.style.fontSize = '2rem';
            overlay.innerHTML = `
            <p>${message}</p>
            <button id="restartBtn" style="padding:10px 20px; font-size:1rem; margin-top:20px;">Restart Game</button>
            `;
            document.body.appendChild(overlay);
            document.getElementById('restartBtn').addEventListener('click', () => {
                board = Array(9).fill(0);
                gameOver = false;
                overlay.remove();
                renderBoard();
                });
            }

            function playerMove(index) {
                if (gameOver || board[index] !== 0) return;
                board[index] = 1;
                renderBoard();
                let winner = checkWinner();
                if (winner !== null) {
                    showResult(winner);
                    return;
                }
                fetchBotMove();
            }

            async function fetchBotMove() {
                const res = await fetch('http://127.0.0.1:5000/move', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ board })
                });
                const data = await res.json();
                if (data.move !== null && board[data.move] === 0) {
                    board[data.move] = -1;
                }
                renderBoard();
                let winner = checkWinner();
                if (winner !== null) {
                    showResult(winner);
                }
            }
            renderBoard();
        </script>
    </body>
</html>

